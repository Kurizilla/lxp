generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NotificationType {
  EMAIL
  IN_APP
  PUSH
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

model User {
  id        BigInt   @id @default(autoincrement())
  email     String?  @unique
  name      String?
  role      String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  notifications          Notification[]
  notificationPreference NotificationPreference?
  createdAnnouncements   Announcement[]

  @@map("m01_users")
}

model Notification {
  id        BigInt           @id @default(autoincrement())
  userId    BigInt           @map("user_id")
  type      NotificationType
  priority  Priority
  title     String
  message   String
  isRead    Boolean          @default(false) @map("is_read")
  readAt    DateTime?        @map("read_at")
  createdAt DateTime         @default(now()) @map("created_at")
  updatedAt DateTime         @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], name: "idx_m01_notifications_user_id")
  @@index([readAt], name: "idx_m01_notifications_read_at")
  @@index([userId, isRead], name: "idx_m01_notifications_user_read")
  @@map("m01_notifications")
}

model Announcement {
  id          BigInt           @id @default(autoincrement())
  creatorId   BigInt?          @map("creator_id")
  title       String
  content     String
  type        NotificationType
  priority    Priority
  targetRoles String[]         @default([]) @map("target_roles")
  isActive    Boolean          @default(true) @map("is_active")
  publishedAt DateTime         @default(now()) @map("published_at")
  expiresAt   DateTime?        @map("expires_at")
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")

  creator User? @relation(fields: [creatorId], references: [id], onDelete: SetNull)

  @@index([isActive, publishedAt], name: "idx_m01_announcements_active_published")
  @@index([targetRoles], name: "idx_m01_announcements_target_roles")
  @@map("m01_announcements")
}

model NotificationPreference {
  id           BigInt   @id @default(autoincrement())
  userId       BigInt   @unique @map("user_id")
  emailEnabled Boolean  @default(true) @map("email_enabled")
  inAppEnabled Boolean  @default(true) @map("in_app_enabled")
  pushEnabled  Boolean  @default(false) @map("push_enabled")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("m01_notification_preferences")
}
